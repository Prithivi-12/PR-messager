<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PR Message - Advanced Communications</title>
    <link rel="stylesheet" href="style.css">
    <!-- Appwrite SDK -->
    <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.1"></script>
</head>
<body>
    <div id="app" class="app-container">
        <!-- Home Screen -->
        <div id="homeScreen" class="screen active">
            <div class="container">
                <div class="home-content">
                    <div class="hero-section">
                        <h1 class="app-title">üõ°Ô∏è PR Message</h1>
                        <p class="app-subtitle">Bulletproof video chat, voice calls, screen sharing, and file transfer with Appwrite backend</p>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="createInviteBtn" class="btn btn--primary btn--lg btn--full-width">
                            <span>üîí Create Bulletproof Room</span>
                        </button>
                        <button id="joinWithCodeBtn" class="btn btn--outline btn--lg btn--full-width">
                            <span>üõ°Ô∏è Join with Code</span>
                        </button>
                    </div>
                    
                    <!-- Enhanced Debug Panel -->
                    <div id="debugPanel" class="debug-panel hidden">
                        <h4>üîß Bulletproof Debug Console</h4>
                        <div id="debugContent"></div>
                        <div class="debug-actions">
                            <button id="clearRoomsBtn" class="btn btn--sm btn--danger">Clear All Rooms</button>
                            <button id="testConnectionBtn" class="btn btn--sm btn--info">Test Appwrite</button>
                            <button id="toggleDebugBtn" class="btn btn--sm btn--secondary">Hide Debug</button>
                        </div>
                    </div>
                    <button id="showDebugBtn" class="btn btn--sm btn--outline debug-toggle">üîß Debug Console</button>
                </div>
            </div>
        </div>

        <!-- Create Invite Screen -->
        <div id="createInviteScreen" class="screen">
            <div class="container">
                <div class="invite-content">
                    <div class="back-header">
                        <button id="backFromCreateBtn" class="btn btn--outline btn--sm">‚Üê Back</button>
                        <h2>Create Room</h2>
                    </div>
                    
                    <div class="invite-card card">
                        <div class="card__body">
                            <div id="codeGenerating" class="loading-state">
                                <div class="spinner"></div>
                                <p>Generating bulletproof code...</p>
                            </div>
                            
                            <div id="codeGenerated" class="code-display hidden">
                                <h3>Your Room Code</h3>
                                <div class="code-container">
                                    <div id="inviteCode" class="invite-code"></div>
                                    <button id="copyCodeBtn" class="btn btn--outline btn--sm">
                                        <span>üìã Copy</span>
                                    </button>
                                </div>
                                <div class="code-info">
                                    <p>Share this code with someone to start chatting</p>
                                    <div class="storage-status">
                                        <span id="storageStatus" class="status-indicator">üü¢ Stored in Appwrite</span>
                                    </div>
                                </div>
                                <div id="waitingForJoiner" class="waiting-state">
                                    <div class="pulse-dot"></div>
                                    <p>Waiting for someone to join...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Join Screen -->
        <div id="joinScreen" class="screen">
            <div class="container">
                <div class="join-content">
                    <div class="back-header">
                        <button id="backFromJoinBtn" class="btn btn--outline btn--sm">‚Üê Back</button>
                        <h2>Join Room</h2>
                    </div>
                    
                    <div class="join-card card">
                        <div class="card__body">
                            <form id="joinForm" class="join-form">
                                <div class="form-group">
                                    <label for="codeInput" class="form-label">Enter Room Code</label>
                                    <input type="text" 
                                           id="codeInput" 
                                           class="form-input" 
                                           placeholder="XXXXXX" 
                                           maxlength="6" 
                                           autocomplete="off">
                                </div>
                                
                                <!-- Real-time validation feedback -->
                                <div id="validationFeedback" class="validation-feedback">
                                    <div class="validation-item">
                                        <span id="lengthCheck" class="validation-icon">‚ö™</span>
                                        <span>Code must be 6 characters</span>
                                    </div>
                                    <div class="validation-item">
                                        <span id="formatCheck" class="validation-icon">‚ö™</span>
                                        <span>Only letters and numbers allowed</span>
                                    </div>
                                    <div class="validation-item">
                                        <span id="existsCheck" class="validation-icon">‚ö™</span>
                                        <span>Room must be available</span>
                                    </div>
                                </div>
                                
                                <div id="joinError" class="error-message hidden"></div>
                                
                                <button type="submit" id="joinBtn" class="btn btn--primary btn--lg btn--full-width">
                                    <span id="joinBtnText">Join Room</span>
                                    <div id="joinSpinner" class="btn-spinner hidden"></div>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Screen -->
        <div id="chatScreen" class="screen">
            <div class="chat-layout">
                <!-- Chat Header -->
                <div class="chat-header">
                    <div class="chat-info">
                        <h3 id="chatTitle">PR Message</h3>
                        <div id="connectionStatus" class="connection-status">
                            <span class="status-dot"></span>
                            <span class="status-text">Connected</span>
                        </div>
                    </div>
                    
                    <!-- Media Controls -->
                    <div class="media-controls">
                        <button id="videoCallBtn" class="media-btn" title="Video Call">
                            <span class="btn-icon">üìπ</span>
                        </button>
                        <button id="voiceCallBtn" class="media-btn" title="Voice Call">
                            <span class="btn-icon">üéôÔ∏è</span>
                        </button>
                        <button id="screenShareBtn" class="media-btn" title="Screen Share">
                            <span class="btn-icon">üñ•Ô∏è</span>
                        </button>
                        <button id="leaveChatBtn" class="btn btn--outline btn--sm">
                            <span>Leave</span>
                        </button>
                    </div>
                </div>

                <!-- Video Call Container -->
                <div id="videoContainer" class="video-container hidden">
                    <video id="localVideo" class="local-video" autoplay muted playsinline></video>
                    <video id="remoteVideo" class="remote-video" autoplay playsinline></video>
                    <div class="video-controls">
                        <button id="toggleCameraBtn" class="video-control-btn">üìπ</button>
                        <button id="toggleMicBtn" class="video-control-btn">üéôÔ∏è</button>
                        <button id="endCallBtn" class="video-control-btn end-call">üìû</button>
                    </div>
                </div>

                <!-- Screen Share Container -->
                <div id="screenShareContainer" class="screen-share-container hidden">
                    <video id="screenVideo" class="screen-video" autoplay playsinline></video>
                    <button id="stopScreenShareBtn" class="btn btn--danger">Stop Sharing</button>
                </div>

                <!-- Messages Area -->
                <div class="chat-body">
                    <div id="messagesList" class="messages-list"></div>
                </div>

                <!-- Message Input -->
                <div class="chat-input">
                    <!-- Voice Recording -->
                    <div id="voiceRecorder" class="voice-recorder hidden">
                        <div class="recording-indicator">
                            <div class="recording-dot"></div>
                            <span id="recordingTime">00:00</span>
                        </div>
                        <div class="recording-controls">
                            <button id="stopRecordingBtn" class="btn btn--danger btn--sm">Stop</button>
                            <button id="cancelRecordingBtn" class="btn btn--outline btn--sm">Cancel</button>
                        </div>
                    </div>

                    <!-- File Drop Zone -->
                    <div id="fileDropZone" class="file-drop-zone hidden">
                        <div class="drop-content">
                            <span class="drop-icon">üìÅ</span>
                            <span class="drop-text">Drop files here to share</span>
                        </div>
                    </div>

                    <!-- Message Form -->
                    <form id="messageForm" class="message-form">
                        <div class="input-container">
                            <button type="button" id="voiceMessageBtn" class="input-btn" title="Voice Message">
                                <span>üé§</span>
                            </button>
                            <button type="button" id="fileShareBtn" class="input-btn" title="Share File">
                                <span>üìé</span>
                            </button>
                            <input type="text" 
                                   id="messageInput" 
                                   class="message-input" 
                                   placeholder="Type a message..." 
                                   autocomplete="off">
                            <button type="submit" id="sendBtn" class="send-btn" title="Send Message">
                                <span>üöÄ</span>
                            </button>
                        </div>
                    </form>

                    <!-- Hidden file input -->
                    <input type="file" id="fileInput" class="hidden" multiple>
                </div>

                <!-- File Transfer Progress -->
                <div id="fileTransferProgress" class="file-progress hidden">
                    <div class="progress-header">
                        <span class="progress-title">Transferring files...</span>
                        <button id="cancelTransferBtn" class="btn btn--sm btn--outline">Cancel</button>
                    </div>
                    <div class="progress-bar">
                        <div id="transferProgressBar" class="progress-fill"></div>
                    </div>
                    <div class="progress-info">
                        <span id="transferFileName">filename.pdf</span>
                        <span id="transferSpeed">1.2 MB/s</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Configuration and App -->
    <script src="appwrite-config.js"></script>
    <script src="app.js"></script>
</body>
</html>
